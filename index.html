<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyWeb Pioneers | Truth Scanner 4.0</title>
    <style>
        :root {
            --neon-cyan: #00f3ff;
            --dark-bg: #0a0a0a;
            --panel-bg: #111;
            --text-color: #e0e0e0;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Courier New', monospace; }
        
        body {
            background-color: var(--dark-bg);
            color: var(--text-color);
            overflow-x: hidden;
        }

        /* --- HEADER --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            border-bottom: 1px solid #333;
            background: rgba(0,0,0,0.9);
        }

        .brand { font-size: 1.5rem; font-weight: bold; display: flex; align-items: center; gap: 10px; }
        .brand span { color: var(--neon-cyan); }
        .brand .diamond { color: var(--neon-cyan); font-size: 1.2em; }

        .system-status { font-size: 0.9rem; color: var(--neon-cyan); }

        /* --- HERO SECTION --- */
        .hero {
            text-align: center;
            padding: 60px 20px;
            border-bottom: 1px solid #222;
        }
        
        h1 { font-size: 3rem; margin-bottom: 10px; letter-spacing: 2px; }
        h1 span { color: var(--neon-cyan); }

        /* --- GRID LAYOUT --- */
        .container {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
            padding: 40px;
            max-width: 1600px;
            margin: 0 auto;
        }

        @media (max-width: 1024px) { .container { grid-template-columns: 1fr; } }

        /* --- PANELS --- */
        .panel {
            background: var(--panel-bg);
            border: 1px solid #333;
            padding: 20px;
            border-radius: 4px;
        }
        .panel-header {
            color: var(--neon-cyan);
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            margin-bottom: 15px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* --- TRUTH SCANNER INPUT --- */
        textarea {
            width: 100%;
            height: 150px;
            background: #000;
            border: 1px solid #333;
            color: #fff;
            padding: 15px;
            resize: none;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        textarea:focus { outline: 1px solid var(--neon-cyan); }

        button {
            background: var(--neon-cyan);
            color: #000;
            border: none;
            padding: 12px 30px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            transition: 0.3s;
            width: 100%;
        }
        button:hover { box-shadow: 0 0 15px var(--neon-cyan); }
        button:disabled { background: #333; color: #666; cursor: not-allowed; box-shadow: none; }

        /* --- RESULTS AREA --- */
        #result-area {
            margin-top: 20px;
            display: none; 
            border: 1px solid #333;
            padding: 20px;
            background: #050505;
        }
        .verdict-real { color: #0f0; font-size: 1.5rem; font-weight: bold; }
        .verdict-fake { color: #f00; font-size: 1.5rem; font-weight: bold; }
        .verdict-suspicious { color: #fbff00; font-size: 1.5rem; font-weight: bold; }
        
        .source-link { 
            display: block; 
            color: var(--neon-cyan); 
            text-decoration: none; 
            margin-top: 5px; 
            font-size: 0.9rem;
        }
        .source-link:hover { text-decoration: underline; }

        /* --- WIDGETS (Stocks & Weather) --- */
        .widget-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #222;
            font-size: 0.9rem;
        }
        .up { color: #0f0; }
        .down { color: #f00; }

        .weather-display { text-align: center; padding: 20px; }
        .temp-large { font-size: 3rem; font-weight: bold; color: #fff; }

    </style>
</head>
<body>

    <header>
        <div class="brand">
            <span class="diamond">â—†</span> PYWEB <span>PIONEERS</span>
        </div>
        <div class="system-status" id="clock">SYSTEM ONLINE</div>
    </header>

    <div class="hero">
        <h1>INVESTIGATE <span>TRUTH</span></h1>
        <p>AI-POWERED DECEPTION DETECTION SYSTEM 4.0</p>
    </div>

    <div class="container">
        
        <!-- LEFT PANEL: LIVE DATA -->
        <aside class="panel">
            <div class="panel-header">Market Data</div>
            <div id="stocks-list">Loading Market Stream...</div>
            
            <div class="panel-header" style="margin-top: 30px;">Local Atmos</div>
            <div id="weather-box" class="weather-display">
                Initializing Sensors...
            </div>
        </aside>

        <!-- CENTER PANEL: SCANNER -->
        <main class="panel">
            <div class="panel-header">Input News Source</div>
            <textarea id="newsInput" placeholder="Paste suspicious news article text here for analysis..."></textarea>
            <button onclick="analyzeTruth()" id="scanBtn">INITIATE SCAN</button>

            <div id="result-area">
                <div id="verdict-display"></div>
                <p id="reasoning-display" style="margin: 15px 0; line-height: 1.5;"></p>
                <div class="panel-header" style="margin-top:20px; font-size: 0.8rem;">Verified Sources</div>
                <div id="sources-list"></div>
            </div>
        </main>

        <!-- RIGHT PANEL: NEWS FEED -->
        <aside class="panel">
            <div class="panel-header">System Logs</div>
            <div style="font-size: 0.8rem; color: #666; line-height: 1.8;">
                > System boot sequence complete<br>
                > Connected to Perplexity Sonar-Pro<br>
                > Finnhub API Stream: ACTIVE<br>
                > Open-Meteo Uplink: STABLE<br>
                > Ready for input...
            </div>
        </aside>

    </div>

    <script>
        // --- 1. CLOCK ---
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.toUTCString();
        }, 1000);

        // --- 2. API PATHS (THE FIX) ---
        // NOTICE: No "http://localhost:3000". Just "/"
        const API_BASE = ""; 

        // --- 3. STOCKS ---
        async function loadStocks() {
            try {
                const res = await fetch(`${API_BASE}/api/stocks`);
                const data = await res.json();
                const container = document.getElementById('stocks-list');
                
                if (data.error) throw new Error(data.error);

                container.innerHTML = data.map(stock => `
                    <div class="widget-item">
                        <strong>${stock.name}</strong>
                        <span>${stock.val} <span class="${stock.dir}">${stock.change}</span></span>
                    </div>
                `).join('');
            } catch (e) {
                document.getElementById('stocks-list').innerText = "Market Offline";
            }
        }

        // --- 4. WEATHER ---
        function initWeather() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    loadWeather(lat, lon);
                }, () => {
                    // Default to New York if permission denied
                    loadWeather(40.71, -74.00); 
                });
            } else {
                loadWeather(40.71, -74.00);
            }
        }

        async function loadWeather(lat, lon) {
            try {
                const res = await fetch(`${API_BASE}/api/weather?lat=${lat}&lon=${lon}`);
                const data = await res.json();
                
                if (data.error) throw new Error(data.error);

                document.getElementById('weather-box').innerHTML = `
                    <div class="temp-large">${data.temp}Â°C</div>
                    <div>${data.city}</div>
                    <div style="color: var(--neon-cyan)">${data.description}</div>
                `;
            } catch (e) {
                document.getElementById('weather-box').innerText = "Weather Offline";
            }
        }

        // --- 5. TRUTH ANALYZER ---
        async function analyzeTruth() {
            const input = document.getElementById('newsInput').value;
            const btn = document.getElementById('scanBtn');
            const resultArea = document.getElementById('result-area');

            if (!input.trim()) return alert("Please enter text to analyze.");

            // UI Loading State
            btn.disabled = true;
            btn.innerText = "SCANNING DEEP WEB...";
            resultArea.style.display = 'none';

            try {
                const res = await fetch(`${API_BASE}/api/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: input })
                });

                const data = await res.json();

                // Render Results
                const verdictClass = data.verdict === 'REAL' ? 'verdict-real' : 
                                   (data.verdict === 'FAKE' ? 'verdict-fake' : 'verdict-suspicious');

                document.getElementById('verdict-display').className = verdictClass;
                document.getElementById('verdict-display').innerText = `VERDICT: ${data.verdict} (${data.confidence})`;
                document.getElementById('reasoning-display').innerText = data.reasoning;

                const sourcesHtml = data.sources.map(s => 
                    `<a href="${s.url}" target="_blank" class="source-link">ðŸ”— ${s.title}</a>`
                ).join('');
                document.getElementById('sources-list').innerHTML = sourcesHtml || "No public sources found.";

                resultArea.style.display = 'block';

            } catch (error) {
                alert("System Error: Could not connect to AI.");
            } finally {
                btn.disabled = false;
                btn.innerText = "INITIATE SCAN";
            }
        }

        // Start Systems
        loadStocks();
        initWeather();

    </script>
</body>
</html>
